title: 虚拟技术
theme: light

[slide]
# 虚拟技术

[slide]
# 为何选择虚拟化
随着信息技术应用的深入，经常出现下面情况：

- 业务开通有利于慢：更多部门需要升级或者开展新业务，导致需要采购软硬件设备，而采购需要周期；
- 资源闲置越来越多：信息部门管理的资源类型繁多，如服务器、网络、存储设备等，而大多数时间业务系统并非按最初设想的那样繁忙；
- 无法应对资源突发情况：突发时段内，某业务访问量剧增，远超过最初设计值，导致系统瘫痪；当花费大代价扩容后，资源在大多数时间闲置；
- 无法灵活的进行资源重用：无法重用闲置资源；

[slide]
# 虚拟化的价值
采用虚拟化技术可以解决上述问题

- 资源池化与服务可度量：对服务器、网络、存储等资源池化，通过部署服务度量平台，细粒度检测各项指标，根据资源消耗计费；
- 业务快速响应：业务部门通过自助服务申请资源，服务根据访问量计费，虚拟主机开通只要1分钟，并且可以并行处理，可以快速响应业务需求；
- 提升效能：虚拟化可以在一台物理主机上运行多个虚拟主机，直接降低了采购成本以及运营成本；
- 运维转型与价值提升：运维只要提供各种信息化服务，业务部门根据需求购买服务，降低了身体运营成本；同时运维可以将闲置资源开发成服务出售，提升自身价值；


[slide]
# 虚拟化构架
云计算的核心是资源池化与弹性可伸缩，而资源池化与弹性可伸缩本质上是如何实现资源的虚拟化。目前主要解决方案有下面两种：

- 传统的IT云计算模式：面向企事业单位，基于用户现有基础设施环境，对服务器、网络、存储等进行统一规划与架构，通过虚拟化平台实现的一种解决方案。
- 分布式云计算构架模式：有低廉的物理服务器组成，通过Hadoop平台和开源虚拟化平台实现集群服务，主要应用于互联网企业。

> 前者属于傻瓜模式，投入成本高、管理成本低，通过商用平台可以保障高可靠些和高稳定性；后者投入成本低，使用成本高，存在硬件本身的可靠性问题，比如磁盘节点失效的问题；同时要求使用者具有一定开发能力，也是隐形成本；


[slide]
# 虚拟化概述
虚拟化原理来说，它构建了一个中间层，对上是应用环境，提供指令集接口；对下是操作系统或者硬件设备，调用他们的指令集来实现虚拟主机的指令。运行的虚拟主机的每一个操作都是通过中间层接口翻译传送到设备层，执行结果反馈给虚拟主机。中间层的本质就是翻译与映射的工作。

虚拟就是将服务器物理资源抽象成逻辑资源，让一台服务器变成N台互相隔离的虚拟服务器，其CPU、内存、磁盘、I/O等硬件变成可以动态管理的资源池。

服务虚拟化的定义：一种软件技术通过在服务器硬件和软件之间添加虚拟中间层，使得单一服务器可以运行多个操作系统或者应用。

[slide]
# 虚拟化历史
- 20世纪60年代：IBM在System360主机上的VMM
- 20世纪90年代：IBM逻辑分区LPAR技术实现多独立分区运行
- 20世纪90年代：VMware公司的ESX平台、Citrix的Xen平台、微软的Hyper-v平台、Redhat的KVM平台

[slide]
# 虚拟化特性
虚拟化技术具有隔离性、便携性、硬件独立性、资源利用高等特性。

- 资源利用率高
- 可靠性
- 隔离性
- 便携性
- 硬件独立性

[slide]
# 服务虚拟化分类
虚拟化技术从使用类型可以分为平台虚拟化、资源虚拟化、应用虚拟化这三种。现在主要讨论服务器虚拟化技术，根据原理不同可以分为完全虚拟化、超虚拟化、操作系统虚拟化、硬件加速虚拟化、部分虚拟化等。

1 . 完全虚拟化  
完全虚拟化是指Hypervisor层完全模拟了完整的底层硬件，为原始硬件环境设计的操作系统或系统软件不做任何修改可以运行与虚拟主机之中。目前主要产品包括Microsoft VirtualPC、VMware Workstation、Sun VirtualBox、Parallels Destop for Mac。

2 . 超虚拟化  
与完全虚拟化类似，模拟了大部分外设环境，但是有部分硬件接口以软件调用的形式提供给客户机操作系统，通过特权状态的代码与硬件交互。目前主要平台如Denali、Xen平台。

3 . 操作系统虚拟化  
在服务器操作系统中的轻量级虚拟化技术，内核通过创建多个虚拟的操作系统实例来隔离不同的进程，而不同实例中的服务进程完全感知不到对方的存在。目前主要有Solaris Container、FreeBSD Jail和OpenVZ。

4 . 硬件加速虚拟化  
类似于完全虚拟化，不同之处在于虚拟化技术本身需要依赖于硬件平台。比如x86平台的Intel-VT和AMD-V的加速虚拟化技术。

5 . 部分虚拟化   
Hypervisor层自模拟部分硬件设备，用户在使用时需要对客户机操作系统进行定制修改才能运行。

[slide]
# VMware介绍
1998年成立的VMware公司据有关三条虚拟化产品线：数据中心产品、桌面产品和其他虚拟化辅助产品。其数据中心产品的目标是整合基础设施，提供以及虚拟化基础构架的数据中心操作系统。VMware数据中心产品为VMware vSphere。

[slide]
# vSphere组件
vSphere为云操作系统，本质就是利用虚拟化功能将数据中心转换为云计算基础构架，包括：

- 基础构架服务：用于抽象、聚合和分配硬件的服务集；
- 应用程序服务：确保应用服务程序的可用性、安全性和可扩展性的服务集；
- VMware VCenter Server：提供基本的控制服务，如访问控制、性能监控和配置功能
- 客户端：用户可以通过WebAccess或vSphere Client访问数据中心；

[slide]
# vSphere物理拓扑

- 安装ESX/ESXi软件的物理主机就是计算服务器；
- 计算服务器成为独立主机，多台独立主机通过网络连接，提供虚拟资源池即集群
- 每台计算服务器必须配置多个网卡；
- 通过vCenter提供多种数据管理和虚拟机访问界面，包括sSphere客户端、WebAccess和命令行界面
<img src="img/cloud/cloud/virtual01.png" width="">

[slide] 
# vSphere虚拟数据中心
vSphere将底层物理资源虚拟化，形成虚拟环境中可以动态分配和管理的标准元素，包括：

- 主机、集群和资源池：计算资源和内存资源
- 数据存储：存储资源，服务器本地的SCSI、SAS或SATA磁盘，磁盘阵列等；
- 网络：网络资源
- 虚拟机：创建虚拟机时，虚拟机被指定到特定主机、集群或者而资源池以及数据存储，几秒钟内即可完成，同时会安装相应的操作系统和应用程序处理特定的工作负载。

<img src="img/cloud/cloud/virtual02.png" width="">

[slide]
# vSphere计算资源与内存资源

<img src="img/cloud/cloud/virtual03.png" width="">

[slide]
# vSphere网络资源
vNIC

vNetwork标准交换机
<img src="img/cloud/cloud/virtual04.png" width="">

vNetwork分布式交换机
<img src="img/cloud/cloud/virtual05.png" width="">
[slide]
# vSphere存储资源

[slide]
# vSphere资源管理

- 虚拟机置备
- 主机和虚拟机配置
- 资源和虚拟机清单管理
- 统计信息和日志
- 警报和事件管理
- 任务调度
- 整合

[slide]
# 虚拟机的作用
虚拟机像真实电脑一样可以安装操作系统，可以模拟出其他的平台，比如在Windows操作系统下，通过虚拟机可以模拟出Linux，或者Win7/8下安装XP/7系统等，每个虚拟计算机可以独立运行，可以安装各种软件与应用等。

- 主要用于软件的测试
- 游戏多开：按照一般情况，一个电脑只能开一个游戏窗口，虚拟机可以模拟多个操作系统，实现游戏窗口多开
- 测试病毒、木马、外挂：利用虚拟机可以测试病毒、木马、外挂，完全没有感染本机的可能，因为虚拟机相当于另外一个电脑，别人电脑中毒关你什么事情?
- 虚拟服务器：安装一个服务器操作系统，相当于自己拥有一个网站服务器，学网页制作的就可以轻松在本机制作调试网站
- 打造属于个人的安全上网环境：目前随着网购的兴起，我们可以利用虚拟机创建一个属于自己的安全上网环境，安装好系统补丁和开启防火墙，就可以安心的使用网银等重要操作了。

[slide]
# VMware虚拟机目录文件
1. nvram文件存储虚拟机的BIOS信息。
2. vmdk是虚拟机的虚拟硬盘文件，和xen一样，vmware的虚拟硬盘可以是动态分配的，也可以是静态分配的。
3. vmsd 以及vmsn 文件是快照文件，vmsd文件用来存储当前使用的快照的状态，vmsn文件用来存储当前快照的元数据。它们的文件名和快照名称相同。
4. vmx 以及vmxf 是vmware生成的虚拟机配置文件，可以用普通的文本编辑器编辑，其中保存着虚拟机的各项配置，诸如硬盘，光盘，网卡，虚拟机名等配置信息都保存其中。
5. log 文件就是vmware的日志文件。
6. vmss 文件是vmware保存suspend的虚拟机状态的文件。
7. vmem 文件是vmware虚拟机运行时的页面文件(paging file)，即虚拟机内存的镜像。


